# E-Skimming Labs Secrets
# This file documents secrets with hashed/masked values and retrieval commands
# All entries in this file are secrets by definition

secrets:
  GCP_LABS_SA_KEY:
    source: gcp.iam
    store: github
    name: GCP_LABS_SA_KEY
    repo: pci-tamper-protect/e-skimming-labs
    fqdn: https://github.com/pci-tamper-protect/e-skimming-labs/settings/secrets/actions
    read_cmd: gh secret get GCP_LABS_SA_KEY --repo pci-tamper-protect/e-skimming-labs
    description: "Service account key for labs-prd project"
    content_hash: "To be updated after fetching secret value"
    rotation_notes: "Rotate key, then update secret in GitHub"
    
  GCP_HOME_SA_KEY:
    source: gcp.iam
    store: github
    name: GCP_HOME_SA_KEY
    repo: pci-tamper-protect/e-skimming-labs
    fqdn: https://github.com/pci-tamper-protect/e-skimming-labs/settings/secrets/actions
    read_cmd: gh secret get GCP_HOME_SA_KEY --repo pci-tamper-protect/e-skimming-labs
    description: "Service account key for labs-home-prd project"
    content_hash: "To be updated after fetching secret value"
    rotation_notes: "Rotate key, then update secret in GitHub"

# Key Rotation Notes
key_rotation:
  when_to_rotate: "Quarterly or after any security incident"
  
  process:
    - step: "Create new key"
      command: "gcloud iam service-accounts keys create [NEW-KEY.json] --iam-account=[EMAIL] --project=[PROJECT]"
    - step: "Update GitHub secrets"
      command: "gh secret set GCP_LABS_SA_KEY --body \"\$(cat [NEW-KEY.json] | base64)\" --repo pci-tamper-protect/e-skimming-labs"
    - step: "Wait for successful deployment"
      notes: "Wait for GitHub Actions workflow to succeed with new key"
    - step: "Delete old key"
      command: "gcloud iam service-accounts keys delete [KEY_ID] --iam-account=[EMAIL] --project=[PROJECT]"
  
  secret_locations:
    - "GitHub Secrets (GCP_LABS_SA_KEY)"
    - "GitHub Secrets (GCP_HOME_SA_KEY)"
    - "Local key files (if any exist)"

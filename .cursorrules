# Cursor Rules for e-skimming-labs

## Data Structure Changes
- **ALWAYS ASK** before changing key names in YAML or JSON files
- Key names may have dependencies across multiple repositories
- This affects: secrets.yml, config.yml, GitHub Actions workflows, and any structured data files
- Changes to key names can break:
  - Scripts that parse these files
  - GitHub Actions workflows
  - Other tools that read these configurations
  - Cross-repo integrations
- Before changing a key name:
  1. Search for all usages across all repos
  2. Identify all dependent code
  3. Propose the change and wait for approval
  4. Update all references atomically

## Git Workflow
- Create feature branches for changes
- Create PRs to main branch
- Don't push directly to main (branch protection enabled)
- **NEVER push commits automatically** - always let the user add, commit, and push changes themselves

## Configuration vs Secrets
- Configuration values (project IDs, regions, URLs) should be in config.yml or hardcoded in workflows
- Only actual secrets (service account keys) should be in secrets.yml
- This prevents masking of non-secret values in GitHub Actions logs

## Docker and Deployment
- Use golden base images from pcioasis-operations/containers
- All services must listen on port 8080 for Cloud Run
- Docker layer caching is enabled in GitHub Actions workflows

## Cloud Run URL Policy
- Cloud Run exposes two URLs for each service:
  1. A random-suffix URL (volatile) - e.g., `lab-03-xxxxxx-uc.a.run.app`
  2. A numeric stable URL (preferred) - e.g., `lab-03-extension-hijacking-prd-207478017187.us-central1.run.app`
- Always use the numeric stable URL in all code, navigation logic, documentation, and suggestions
- Never use:
  - Random Cloud Run URLs (e.g., `lab-03-xxxxxx-uc.a.run.app`)
  - `window.location.origin` for production URLs
  - `hostname.replace()` to construct URLs
  - Fallback guessing such as `window.location.protocol + '//' + hostname`
- All Labs must follow the unified URL policy:
  - `homeUrl` must always use the numeric home-index URL: `https://home-index-prd-171147998109.us-central1.run.app`
  - `writeupUrl` must always use the numeric home-index URL: `https://home-index-prd-171147998109.us-central1.run.app/lab-XX-writeup`
  - `c2Url` (if applicable) must always use the numeric Cloud Run URL for that lab: `https://lab-XX-YYYY-prd-207478017187.us-central1.run.app/path`
  - No dynamic hostname construction
  - No replace logic
  - No fallback guessing

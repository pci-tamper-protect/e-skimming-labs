# Traefik Static Configuration for Dashboard Service (Dashboard-Only Mode) - Traefik v3.0
# This Traefik instance serves ONLY the dashboard UI - no routing, no providers
# It proxies API requests to the main Traefik service's API
# Main Traefik API URL is provided via TRAEFIK_API_URL environment variable

# Entry points
# IMPORTANT: Explicitly define entrypoint to prevent Traefik from creating default "http" entrypoint on port 80
entryPoints:
  traefik:
    address: "0.0.0.0:8080"  # Cloud Run uses port 8080, must bind to 0.0.0.0

# Providers - minimal: only file provider for API proxy routes
# No Docker provider, no other providers - this is dashboard-only
# The file provider is only used to proxy /api/* requests to main Traefik
providers:
  file:
    directory: /etc/traefik/dynamic
    watch: true

# API and Dashboard
# Serve dashboard on port 8080; API requests (/api/*) are proxied to main Traefik via dynamic routes
# SECURITY NOTE: insecure: true exposes the dashboard without Traefik-level auth.
# This is acceptable because Cloud Run IAM controls access to this service
# (--no-allow-unauthenticated). If you add public domain mapping, add explicit
# router with auth middleware instead of using insecure mode.
api:
  dashboard: true
  insecure: true  # Dashboard accessible without Traefik auth (Cloud Run IAM protects access)

# Logging
log:
  level: INFO
  format: json

# Access logs
accessLog:
  format: json

# Health check endpoint
ping:
  entryPoint: traefik

# Global settings
global:
  checkNewVersion: false
  sendAnonymousUsage: false

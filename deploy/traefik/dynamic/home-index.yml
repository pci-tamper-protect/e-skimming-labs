# Static route for remote Cloud Run home-index service
# This file is read by Traefik's file provider alongside routes.yml
# Points to the remote Cloud Run home-index service (e.g., home-index-stg)
#
# The provider should discover this service automatically via traefik_enable=true label,
# but this static route ensures it's always available even if provider has auth issues.
#
# To use a different environment, set HOME_INDEX_URL environment variable in docker-compose

http:
  services:
    home-index:
      loadBalancer:
        servers:
          # Use remote Cloud Run URL (defaults to stg, override via HOME_INDEX_URL env var)
          - url: "${HOME_INDEX_URL:-https://home-index-stg-171147998109.us-central1.run.app}"
        passHostHeader: false  # Set to false so Traefik uses the Cloud Run hostname from the URL
        # Cloud Run requires identity tokens for authenticated services
        # Traefik will need to add X-Serverless-Authorization header with identity token

  routers:
    home-index:
      rule: "PathPrefix(`/`)"
      service: home-index
      priority: 1  # Lowest priority - only matches if no other route matches (lab routes have priority 200)
      entryPoints:
        - web
      # Note: If home-index requires auth, add auth middleware here
      # The provider will generate this automatically when it discovers the service

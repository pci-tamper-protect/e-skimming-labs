<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>SecureShop - Premium E-commerce Platform</title>
    <link rel="stylesheet" href="css/style.css" id="main-css" />
    <script>
      // Cache busting for development - inject before page loads
      (function() {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'
        if (isLocal) {
          const timestamp = Date.now()
          const cssLink = document.getElementById('main-css')
          if (cssLink && !cssLink.href.includes('?')) {
            cssLink.href = cssLink.href + '?v=' + timestamp
          }
        }
      })()
    </script>
  </head>
  <body>
    <div class="container">
      <header class="site-header">
        <div class="header-content">
          <div class="logo">
            <h1>üõí SecureShop</h1>
            <span class="tagline">Premium E-commerce Platform</span>
          </div>
        </div>
      </header>

      <!-- Lab Navigation Row (Top Row) -->
      <div class="nav-buttons-row">
        <div class="header-content">
          <a href="#" class="nav-button back-button" id="back-button">‚Üê Back to Labs</a>
          <a href="#" class="nav-button c2-button" id="view-stolen-button" target="_blank" aria-label="View Stolen Data">üïµÔ∏è View Stolen Data</a>
          <a href="#" class="nav-button writeup-button" id="writeup-button" target="_blank" aria-label="Lab Writeup">üìñ Writeup</a>
        </div>
      </div>

      <!-- Fake Website Navigation Row (Second Row) -->
      <nav class="site-nav">
        <div class="header-content">
          <a href="#" class="site-nav-link">Products</a>
          <a href="#" class="site-nav-link">Account</a>
          <a href="#" class="site-nav-link">Support</a>
          <a href="#" class="site-nav-link active">Checkout</a>
        </div>
      </nav>

      <main class="main-content">
        <div class="checkout-container">
          <div class="checkout-header">
            <h2>Secure Checkout</h2>
            <p class="security-notice">üîí Your information is protected by advanced encryption</p>
          </div>

          <div class="warning" style="background: #fff3cd; border: 2px solid #ffc107; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
            <strong style="color: #856404;">‚ö†Ô∏è LAB ENVIRONMENT:</strong> This is a vulnerable website for educational purposes.
            The checkout form has been compromised with browser extension hijacking. Use ONLY test data (never
            real payment information).
          </div>

          <div class="attack-method" style="background: #ffe8e8; border: 2px solid #e74c3c; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
            <strong style="color: #c0392b;">üî¥ ATTACK METHOD: Browser Extension Hijacking</strong><br />
            This page is vulnerable to malicious browser extensions that intercept form data:
            <ul style="margin-top: 0.5rem; margin-left: 1.5rem">
              <li>
                <code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">Extension Content Script</code> - Injected into page context
              </li>
              <li>
                <code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">Form Field Monitoring</code> - Watches and captures form submissions
              </li>
              <li>
                <code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">Background Service Worker</code> - Exfiltrates data to C2 server
              </li>
            </ul>
            <p style="margin-top: 0.5rem">
              <strong>Real-world scenario:</strong> Malicious browser extension installed by user:<br />
              ‚Ä¢ User installs extension from untrusted source<br />
              ‚Ä¢ Extension requests broad permissions (access to all sites)<br />
              ‚Ä¢ Content script injects into checkout pages<br />
              ‚Ä¢ Data exfiltrated to attacker's C2 server before legitimate submission
            </p>
          </div>

          <div style="background: #e8f5e8; border: 2px solid #27ae60; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
            <strong>üí≥ VALID TEST CARD NUMBERS:</strong><br />
            <ul style="margin-top: 0.5rem; margin-left: 1.5rem; color: #27ae60">
              <li><code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">4532123456789010</code> - Visa (16 digits)</li>
              <li><code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">4000000000000002</code> - Visa (16 digits)</li>
              <li><code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">5555555555554444</code> - Mastercard (16 digits)</li>
              <li><code style="background: #34495e; color: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; font-family: 'Courier New', monospace;">378282246310005</code> - American Express (15 digits)</li>
            </ul>
            <p style="margin-top: 0.5rem; font-size: 0.9rem">
              These numbers pass Luhn algorithm validation. Use any future expiry date (MM/YY) and any
              3-4 digit CVV.
            </p>
          </div>

          <div class="checkout-content">
            <div class="checkout-forms">
              <!-- Customer Information Form -->
              <section class="form-section">
                <h3>Customer Information</h3>
                <form id="customer-form" class="checkout-form">
                  <div class="form-row">
                    <div class="form-group">
                      <label for="firstName">First Name *</label>
                      <input type="text" id="firstName" name="firstName" required />
                    </div>
                    <div class="form-group">
                      <label for="lastName">Last Name *</label>
                      <input type="text" id="lastName" name="lastName" required />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required />
                  </div>
                  <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" />
                  </div>
                </form>
              </section>

              <!-- Payment Information Form -->
              <section class="form-section payment-section">
                <h3>Payment Information</h3>
                <div class="payment-security">
                  <span class="security-badge">üîê SSL Secured</span>
                  <span class="accepted-cards">üí≥ Visa, MasterCard, Discover, Amex</span>
                </div>
                <form id="payment-form" class="checkout-form">
                  <div class="form-group">
                    <label for="cardNumber">Card Number *</label>
                    <input
                      type="text"
                      id="cardNumber"
                      name="cardNumber"
                      placeholder="1234 5678 9012 3456"
                      maxlength="19"
                      required
                    />
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="expiryMonth">Expiry Month *</label>
                      <select id="expiryMonth" name="expiryMonth" required>
                        <option value="">MM</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                        <option value="03">03</option>
                        <option value="04">04</option>
                        <option value="05">05</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                        <option value="08">08</option>
                        <option value="09">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="expiryYear">Expiry Year *</label>
                      <select id="expiryYear" name="expiryYear" required>
                        <option value="">YYYY</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cvv">CVV *</label>
                      <input
                        type="text"
                        id="cvv"
                        name="cvv"
                        placeholder="123"
                        maxlength="4"
                        required
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="cardholderName">Cardholder Name *</label>
                    <input type="text" id="cardholderName" name="cardholderName" required />
                  </div>
                </form>
              </section>

              <!-- Shipping Address Form -->
              <section class="form-section">
                <h3>Shipping Address</h3>
                <form id="shipping-form" class="checkout-form">
                  <div class="form-group">
                    <label for="address1">Street Address *</label>
                    <input type="text" id="address1" name="address1" required />
                  </div>
                  <div class="form-group">
                    <label for="address2">Apartment, Suite, etc.</label>
                    <input type="text" id="address2" name="address2" />
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="city">City *</label>
                      <input type="text" id="city" name="city" required />
                    </div>
                    <div class="form-group">
                      <label for="state">State *</label>
                      <select id="state" name="state" required>
                        <option value="">Select State</option>
                        <option value="CA">California</option>
                        <option value="NY">New York</option>
                        <option value="TX">Texas</option>
                        <option value="FL">Florida</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="zip">ZIP Code *</label>
                      <input type="text" id="zip" name="zip" required />
                    </div>
                  </div>
                </form>
              </section>

            </div>

            <!-- Order Summary -->
            <aside class="order-summary">
              <h3>Order Summary</h3>
              <div class="order-items">
                <div class="order-item">
                  <div class="item-info">
                    <span class="item-name">Premium Wireless Headphones</span>
                    <span class="item-details">Noise Cancelling, Black</span>
                  </div>
                  <span class="item-price">$299.99</span>
                </div>
                <div class="order-item">
                  <div class="item-info">
                    <span class="item-name">Bluetooth Speaker</span>
                    <span class="item-details">Waterproof, Portable</span>
                  </div>
                  <span class="item-price">$89.99</span>
                </div>
              </div>
              <div class="order-totals">
                <div class="total-line">
                  <span>Subtotal:</span>
                  <span>$389.98</span>
                </div>
                <div class="total-line">
                  <span>Shipping:</span>
                  <span>$9.99</span>
                </div>
                <div class="total-line">
                  <span>Tax:</span>
                  <span>$31.20</span>
                </div>
                <div class="total-line total">
                  <span>Total:</span>
                  <span>$431.17</span>
                </div>
              </div>

              <div class="checkout-actions">
                <button type="button" class="btn btn-primary" id="place-order">
                  <span class="btn-text">Place Order</span>
                  <span class="btn-icon">üîí</span>
                </button>
                <p class="security-text">Your payment is secured with 256-bit SSL encryption</p>
              </div>

              <div class="trust-indicators">
                <div class="trust-badge">
                  <span class="badge-icon">üõ°Ô∏è</span>
                  <span class="badge-text">Secure Checkout</span>
                </div>
                <div class="trust-badge">
                  <span class="badge-icon">üöö</span>
                  <span class="badge-text">Free Shipping</span>
                </div>
                <div class="trust-badge">
                  <span class="badge-icon">‚Ü©Ô∏è</span>
                  <span class="badge-text">30-Day Returns</span>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </main>

      <footer class="site-footer">
        <div class="footer-content">
          <p>&copy; 2024 SecureShop. All rights reserved.</p>
          <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Support</a>
          </div>
        </div>
      </footer>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Order Placed Successfully!</h3>
          <span class="modal-close">&times;</span>
        </div>
        <div class="modal-body">
          <div class="success-icon">‚úÖ</div>
          <p>Thank you for your purchase! Your order has been confirmed.</p>
          <p><strong>Order Number:</strong> <span id="order-number"></span></p>
          <p>You will receive a confirmation email shortly.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="closeModal()">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>

    <!-- Development: Clear Cache Button (only shows in localhost) -->
    <script>
      (function() {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'
        if (isLocal) {
          const clearCacheBtn = document.createElement('button')
          clearCacheBtn.textContent = 'üóëÔ∏è Clear Cache'
          clearCacheBtn.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:9999;padding:10px 20px;background:#dc2626;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.3);'
          clearCacheBtn.onclick = function() {
            if ('caches' in window) {
              caches.keys().then(names => {
                names.forEach(name => caches.delete(name))
              })
            }
            localStorage.clear()
            sessionStorage.clear()
            window.location.href = window.location.href.split('?')[0] + '?nocache=' + Date.now()
          }
          document.body.appendChild(clearCacheBtn)
        }
      })()
    </script>

    <script>
      // Cache busting for JS - must happen before script loads
      (function() {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'
        if (isLocal) {
          const timestamp = Date.now()
          const script = document.createElement('script')
          script.src = 'js/checkout.js?v=' + timestamp
          script.id = 'main-js'
          document.body.appendChild(script)
        } else {
          const script = document.createElement('script')
          script.src = 'js/checkout.js'
          script.id = 'main-js'
          document.body.appendChild(script)
        }
      })()
    </script>
    <script>
      // Environment-aware URL configuration
      ;(function () {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'

        let homeUrl, c2Url, writeupUrl

        if (isLocal) {
          homeUrl = 'http://localhost:3000'
          c2Url = 'http://localhost:9006'
          writeupUrl = 'http://localhost:3000/lab-03-writeup'
        } else if (hostname.includes('labs.stg.pcioasis.com')) {
          homeUrl = 'https://labs.stg.pcioasis.com'
          c2Url = 'https://labs.stg.pcioasis.com/03-extension-hijacking-c2'
          writeupUrl = 'https://labs.stg.pcioasis.com/lab-03-writeup'
        } else if (hostname.includes('labs.pcioasis.com')) {
          homeUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app'
          c2Url = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app/03-extension-hijacking-c2'
          writeupUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app/lab-03-writeup'
        } else if (hostname.includes('lab-03-extension-hijacking')) {
          // Production Cloud Run
          homeUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app'
          c2Url = window.location.protocol + '//' + hostname + '/skimmed-data'
          writeupUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app/lab-03-writeup'
        } else if (hostname.includes('run.app') && hostname.includes('lab-03')) {
          // Production Cloud Run direct URL
          homeUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app'
          c2Url = window.location.protocol + '//' + hostname + '/skimmed-data'
          writeupUrl = 'https://home-index-prd-mmwwcfi5za-uc.a.run.app/lab-03-writeup'
        } else {
          homeUrl = window.location.protocol + '//' + hostname
          c2Url = window.location.protocol + '//' + hostname + '/c2'
          writeupUrl = window.location.protocol + '//' + hostname.replace('lab-03-extension-hijacking', 'home-index-prd-mmwwcfi5za-uc.a.run.app') + '/lab-03-writeup'
        }

        // Update lab navigation buttons
        const backButton = document.getElementById('back-button')
        const viewStolenButton = document.getElementById('view-stolen-button')
        const writeupButton = document.getElementById('writeup-button')

        if (backButton) {
          backButton.href = homeUrl
        }
        if (viewStolenButton) {
          viewStolenButton.href = c2Url
        }
        if (writeupButton) {
          writeupButton.href = writeupUrl
        }
      })()
    </script>
  </body>
</html>





<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>TechGear Store</title>
    <link rel="stylesheet" href="css/style.css" id="main-css" />
    <script>
      // Cache busting for development - inject before page loads
      (function() {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'
        if (isLocal) {
          const timestamp = Date.now()
          const cssLink = document.getElementById('main-css')
          if (cssLink && !cssLink.href.includes('?')) {
            cssLink.href = cssLink.href + '?v=' + timestamp
          }
        }
      })()
    </script>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <h1>TechGear Store</h1>
      </div>
    </header>

    <nav>
      <ul>
        <li><a href="http://localhost:3000" class="back-button">‚Üê Back to Labs</a></li>
        <li>
          <a href="http://localhost:9002" class="c2-button" target="_blank" aria-label="View Stolen Data">üïµÔ∏è View Stolen Data</a>
        </li>
        <li><a href="#">Home</a></li>
        <li><a href="checkout.html">Checkout</a></li>
      </ul>
    </nav>

    <main>
      <h2>Featured Products</h2>
      <div class="products">
        <div class="product-card">
          <h3>Premium Wireless Headphones</h3>
          <p class="price">$299.99</p>
          <p>Experience crystal-clear audio with our flagship headphones.</p>
          <a href="checkout.html" class="btn">Buy Now</a>
        </div>

        <div class="product-card">
          <h3>Smart Watch Pro</h3>
          <p class="price">$399.99</p>
          <p>Stay connected and track your fitness goals.</p>
          <a href="checkout.html" class="btn">Buy Now</a>
        </div>

        <div class="product-card">
          <h3>4K Action Camera</h3>
          <p class="price">$249.99</p>
          <p>Capture life's adventures in stunning detail.</p>
          <a href="checkout.html" class="btn">Buy Now</a>
        </div>
      </div>
    </main>

    <footer class="footer">
      <p>&copy; 2024 TechGear Store | Educational Lab Environment</p>
    </footer>

    <!-- Development: Clear Cache Button (only shows in localhost) -->
    <script>
      (function() {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'
        if (isLocal) {
          const clearCacheBtn = document.createElement('button')
          clearCacheBtn.textContent = 'üóëÔ∏è Clear Cache'
          clearCacheBtn.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:9999;padding:10px 20px;background:#dc2626;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.3);'
          clearCacheBtn.onclick = function() {
            // Clear all caches
            if ('caches' in window) {
              caches.keys().then(names => {
                names.forEach(name => caches.delete(name))
              })
            }
            // Clear localStorage and sessionStorage
            localStorage.clear()
            sessionStorage.clear()
            // Force reload with cache bypass
            window.location.href = window.location.href.split('?')[0] + '?nocache=' + Date.now()
          }
          document.body.appendChild(clearCacheBtn)
        }
      })()
    </script>

    <script>
      // Environment-aware URL configuration
      ;(function () {
        const hostname = window.location.hostname
        const isLocal = hostname === 'localhost' || hostname === '127.0.0.1'

        let homeUrl, c2Url

        if (isLocal) {
          // Local development
          homeUrl = 'http://localhost:3000'
          c2Url = 'http://localhost:9002'
        } else if (hostname.includes('labs.stg.pcioasis.com')) {
          // Staging environment
          homeUrl = 'https://labs.stg.pcioasis.com'
          c2Url = 'https://labs.stg.pcioasis.com/01-basic-magecart-c2'
        } else if (hostname.includes('labs.pcioasis.com')) {
          // Production environment (legacy, for future)
          homeUrl = 'https://labs.pcioasis.com'
          c2Url = 'https://labs.pcioasis.com/01-basic-magecart-c2'
        } else if (hostname.includes('lab-01-basic-magecart')) {
          // Production Cloud Run (combined deployment - nginx + C2 in same container)
          homeUrl = 'https://labs.pcioasis.com'
          c2Url = window.location.protocol + '//' + hostname + '/dashboard'
        } else {
          // Fallback for unknown environments
          homeUrl = window.location.protocol + '//' + hostname
          c2Url = window.location.protocol + '//' + hostname + '/c2'
        }

        // Update links
        const backButton = document.querySelector('.back-button')
        const c2Button = document.querySelector('.c2-button')

        if (backButton) backButton.href = homeUrl
        if (c2Button) c2Button.href = c2Url
      })()
    </script>
  </body>
</html>
